<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Map Manager Pro - A powerful and intuitive map management application for saving, navigating, and organizing locations.">
    <title>Map Manager Pro</title>
    <link rel="icon" type="image/svg+xml" href="assets/icon.svg">
    
    <!-- Performance Optimization: Preconnect -->
    <link rel="preconnect" href="https://cdn.maptiler.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- MapTiler SDK CSS -->
    <link href="https://cdn.maptiler.com/maptiler-sdk-js/v2.0.3/maptiler-sdk.css" rel="stylesheet" />
    <link href="css/style.css" rel="stylesheet">
    <link href="css/layers-nav.css" rel="stylesheet">
    <link href="css/navigation-dashboard.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
</head>
<body>

    <div id="app" class="panel-container">
        <!-- Settings Button -->
        <button id="btn-settings" class="fab-settings" title="Settings">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
        </button>
    
        <!-- Settings Modal -->
        <div id="settings-overlay" class="modal-overlay">
            <div id="settings-modal" class="modal">
                <div class="modal-header" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                    <h2 style="margin:0; font-size: 20px;">Settings</h2>
                    <button id="btn-close-settings" class="btn-icon">
                        <svg class="icon-circlex" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line class="line1" x1="9" y1="15" x2="15" y2="9"></line>
                            <line class="line2" x1="9" y1="9" x2="15" y2="15"></line>
                        </svg>
                    </button>
                </div>
                
                <div class="settings-section">
                    <h3 style="font-size:14px; color:var(--text-secondary); text-transform:uppercase; margin-bottom:12px;">Appearance</h3>
                    
                    <div class="theme-toggles" style="display:flex; gap:10px; background: rgba(128,128,128,0.1); padding:4px; border-radius:12px;">
                        <label class="theme-option">
                            <input type="radio" name="theme" value="light">
                            <span>Light</span>
                        </label>
                        <label class="theme-option">
                            <input type="radio" name="theme" value="dark">
                            <span>Dark</span>
                        </label>
                        <label class="theme-option">
                            <input type="radio" name="theme" value="system">
                            <span>Auto</span>
                        </label>
                    </div>
                </div>
                
                 <div class="settings-section" style="margin-top:24px;">
                    <h3 style="font-size:14px; color:var(--text-secondary); text-transform:uppercase; margin-bottom:12px;">About</h3>
                     <p style="font-size:14px; color:var(--text-secondary);">Map Manager Pro v1.2</p>
                </div>
            </div>
        </div>

        <!-- Dashboard Overlay -->
        <div id="nav-dashboard">
            <div class="nav-top-panel">
                <div class="nav-direction-icon" id="nav-step-icon">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="19" x2="12" y2="5"></line><polyline points="5 12 12 5 19 12"></polyline></svg>
                </div>
                <div class="nav-instruction-text">
                    <div class="nav-distance" id="nav-step-dist">0 m</div>
                    <div class="nav-road" id="nav-step-text">Starting navigation...</div>
                </div>
            </div>

            <!-- Voice Control (Floating) -->
            <button id="btn-voice-toggle" class="nav-voice-control" aria-label="Toggle Voice">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>
            </button>

            <!-- Recenter Control (Floating) -->
            <button id="btn-recenter" class="nav-recenter-control hidden" aria-label="Recenter Map">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="5 9 2 12 5 15"></polyline>
                    <polyline points="9 5 12 2 15 5"></polyline>
                    <polyline points="19 9 22 12 19 15"></polyline>
                    <polyline points="9 19 12 22 15 19"></polyline>
                    <circle cx="12" cy="12" r="3"></circle>
                </svg>
                <span>Re-center</span>
            </button>

            <div class="nav-bottom-panel">
                <div class="nav-trip-info">
                    <div class="nav-time-arrival good" id="nav-arrival-time">--:--</div>
                    <div class="nav-trip-details">
                        <span id="nav-rem-time">0 min</span> â€¢ <span id="nav-rem-dist">0 km</span>
                    </div>
                </div>
                <button id="btn-end-trip" class="btn-end-nav">End</button>
            </div>
        </div>

        <!-- Map Container -->
        <div id="map-container"></div>

        <!-- Clear Route Button -->
        <button id="btn-clear-route" class="btn-clear-route">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></svg>
            Clear Route
        </button>

        <!-- Navigation Panel (Floating) -->
        <div id="nav-panel" class="nav-panel">
            <div class="nav-header">
                <h2>Directions</h2>
                <button id="btn-close-nav" class="btn-icon">
                    <svg class="icon-circlex" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line class="line1" x1="9" y1="15" x2="15" y2="9"></line>
                        <line class="line2" x1="9" y1="9" x2="15" y2="15"></line>
                    </svg>
                </button>
            </div>
            
            <div class="nav-inputs">
                <div class="input-wrapper">
                    <div class="input-icon start-dot"></div>
                    <input type="text" id="nav-start" placeholder="Start Point" autocomplete="off">
                    <button id="btn-clear-start" class="btn-input-clear hidden" data-tooltip="Clear" aria-label="Clear">
                         <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                    </button>
                    <button id="btn-my-location" class="btn-icon-inside" data-tooltip="Use My Location" aria-label="Use My Location">
                         <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2a10 10 0 1 0 10 10 10 10 0 0 0-10-10zm0 18a8 8 0 1 1 8-8 8 8 0 0 1-8 8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                    </button>
                </div>
                <div class="connector-line"></div>
                <div class="input-wrapper">
                    <div class="input-icon dest-pin"></div>
                    <input type="text" id="nav-dest" placeholder="Destination" autocomplete="off">
                    <button id="btn-clear-dest" class="btn-input-clear hidden" data-tooltip="Clear" aria-label="Clear">
                         <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                    </button>
                </div>
                <!-- Suggestions moved inside for positioning -->
                <div id="nav-suggestions" class="nav-suggestions hidden"></div>
            </div>

            <button id="btn-start-nav" class="btn btn-primary btn-block">Start Navigation</button>
        </div>



        <!-- Toggle Button (Visible when sidebar is closed) -->
        <button id="btn-open-sidebar" class="btn-toggle-sidebar" data-tooltip="Open Sidebar" aria-label="Open Sidebar">
             <svg class="icon-panel-left-open" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                 <rect width="18" height="18" x="3" y="3" rx="2" ry="2"></rect>
                 <line class="line" x1="9" y1="3" x2="9" y2="21"></line>
                 <path class="arrow" d="m14 9 3 3-3 3"></path>
             </svg>
        </button>
        
        <!-- Navigation Toggle Button (New) -->
        <button id="btn-open-nav" class="btn-toggle-nav" data-tooltip="Directions" aria-label="Directions">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="3 11 22 2 13 21 11 13 3 11"></polygon></svg>
        </button>

        <!-- Layer Switcher Button -->
        <button id="btn-layers" class="btn-toggle-layers" data-tooltip="Map Layers" aria-label="Map Layers">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path class="icon-layers-path1" d="M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z"/>
                <path class="icon-layers-path2" d="M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12"/>
                <path class="icon-layers-path3" d="M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17"/>
            </svg>
        </button>

        <!-- Layer Panel -->
        <div id="layer-panel" class="layer-panel">
            <h3>Map Style</h3>
            <div class="layer-grid">
                <div class="layer-option active" data-style="STREETS">
                    <div class="layer-preview preview-streets"></div>
                    <span>Streets</span>
                </div>
                <div class="layer-option" data-style="HYBRID">
                    <div class="layer-preview preview-hybrid"></div>
                    <span>Satellite Hybrid</span>
                </div>
            </div>
        </div>

        <!-- Sidebar Panel -->
        <div id="sidebar-panel" class="panel">
            <div class="panel-header">
                <div>
                    <h1>Locations</h1>
                    <div id="search-container" class="search-container">
                        <div class="search-input-wrapper">
                            <input type="text" id="search-input" placeholder="Search places..." autocomplete="off">
                            <button id="btn-clear-search" class="btn-input-clear hidden" data-tooltip="Clear Search" aria-label="Clear Search">
                                 <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                            </button>
                        </div>
                        <button id="btn-trigger-search" class="btn-input-search" data-tooltip="Search" aria-label="Search">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                        </button>
                        <div id="search-results" class="search-results hidden"></div>
                    </div>
                </div>
                <button id="btn-close-sidebar" class="panel-close-btn" data-tooltip="Close Sidebar" aria-label="Close Sidebar">
                    <svg class="icon-circlex" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line class="line1" x1="9" y1="15" x2="15" y2="9"></line>
                        <line class="line2" x1="9" y1="9" x2="15" y2="15"></line>
                    </svg>
                </button>
            </div>
            <div class="panel-actions">
                <button id="btn-export" class="btn btn-secondary btn-sm" data-tooltip="Export Data">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 6px;"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>
                    Export
                </button>
                <button id="btn-import" class="btn btn-secondary btn-sm" data-tooltip="Import Data">
                     <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 6px;"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                    Import
                </button>
                <input type="file" id="file-import" accept=".json" style="display: none;">
            </div>
            <div class="panel-content">
                <div id="location-list" class="location-list">
                    <!-- Location items injected here by JS -->
                    <div style="padding: 20px; text-align: center; color: #888;">
                        No locations yet. Click the + button.
                    </div>
                </div>
            </div>
        </div>

        <!-- Floating Add Button -->
        <button id="btn-add" class="fab-add" data-tooltip="Add Location" aria-label="Add Location">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
        </button>

        <!-- Modal Form -->
        <div id="modal-overlay" class="modal-overlay">
            <div class="modal">
                <h2 style="margin-bottom: 20px;">Add Location</h2>
                <form id="location-form" novalidate>
                    <input type="hidden" id="loc-id">
                    <div class="form-group">
                        <label>Name</label>
                        <input type="text" id="loc-name" class="form-control" required placeholder="e.g. Headquarters">
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <input type="text" id="loc-desc" class="form-control" placeholder="Short description">
                    </div>
                    <div class="form-group">
                        <label>Coordinates (Lat, Lng)</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="number" step="any" id="loc-lat" class="form-control" placeholder="Latitude" required>
                            <input type="number" step="any" id="loc-lng" class="form-control" placeholder="Longitude" required>
                        </div>
                        <small style="color: var(--text-secondary); display: block; margin-top: 5px;">Tip: Click on the map to autofill</small>
                    </div>
                    
                    <div class="modal-actions">
                        <button type="button" id="btn-cancel" class="btn btn-secondary">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Location</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Custom Delete Dialog -->
    <div id="delete-dialog-overlay" class="modal-overlay">
        <div class="modal delete-modal">
            <h2 class="modal-title">Delete Location</h2>
            <p class="modal-desc">Are you sure you want to delete this location? This action cannot be undone.</p>
            <div class="modal-footer">
                <button id="btn-confirm-delete" class="btn btn-destructive">Delete</button>
                <button id="btn-cancel-delete" class="btn btn-outline">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Global Context Menu -->
    <div id="global-context-menu" class="dropdown-menu hidden"></div>

    <!-- Custom Notification/Toast -->
    <div id="notification-container" class="notification-container"></div>



    <!-- MapTiler SDK JS -->
    <script defer src="https://cdn.maptiler.com/maptiler-sdk-js/v2.0.3/maptiler-sdk.umd.js"></script>
    
    <!-- Application Logic -->
    <script type="module" src="js/utils.js"></script>
    <script type="module" src="js/store.js"></script>
    <script type="module" src="js/settings.js"></script>
    <script type="module" src="js/map.js"></script>
    <script type="module" src="js/navigation.js"></script>
    <script type="module" src="js/layers.js"></script>
    <script type="module" src="js/app.js"></script>
</body>
</html>